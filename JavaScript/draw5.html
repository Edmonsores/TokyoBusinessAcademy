<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>お絵かきソフト 1 </title>
<style>
canvas {
border:solid #999999 1px;
}
.pallet button {
    width: 20px;
    height: 20px;
    padding: 0;
    margin: 2px;
    border: 1px solid #333;
}
.red { background-color:#FF0000; }
.yellow { background-color:#FFFF00; }
.green { background-color:#00FF00; }
.cyan { background-color:#00FFFF; }
.blue { background-color:#0000FF; }
.magenta { background-color:#FF00FF; }
.white { background-color:#FFFFFF; }
.black { background-color:#000000; }

#clearButton {
    width: 100px;
}
</style>
</head>
<body onload="changeColor(); changeWidth();">
<canvas id="main" width="640" height="480">
</canvas>
<div class="pallet">
<canvas id="canvasColor" width="20" height="20"></canvas>
ペンの色: [<span id="textColor">R:0,G:0,B:0,A:1.0</span>]<br>
R:<input type="range" id="penR" value="0" min="0" max="255"><br>
G:<input type="range" id="penG" value="0" min="0" max="255"><br>
B:<input type="range" id="penB" value="0" min="0" max="255"><br>
A:<input type="range" id="penA" value="1" min="0" max="1" step="0.1">
<hr>
基本色:
<button type="button" class="red" value="255,0,0"></button>
<button type="button" class="yellow" value="255,255,0"></button>
<button type="button" class="green" value="0,255,0"></button>
<button type="button" class="cyan" value="0,255,255"></button>
<button type="button" class="blue" value="0,0,255"></button>
<button type="button" class="magenta" value="255,0,255"></button>
<button type="button" class="white" value="255,255,255"></button>
<button type="button" class="black" value="0,0,0"></button>
<hr>
<canvas id="canvasWidth" width="20" height="20"></canvas>
ペンの太さ:
<input type="range" id="penW" value="10" min="1" max="20">
<hr>
<button id="clearButton">らくがきを消す</button>
</div>
<script>
// マウスイベントリスナー
document.getElementById('main').addEventListener('mousedown', function(){
startDraw(event);
});
document.getElementById('main').addEventListener('mousemove', function(){
draw(event);
});
document.getElementById('main').addEventListener('mouseup', function(){
endDraw(event);
});

// カラー設定スライダーイベントリスナー
document.getElementById('penR').addEventListener('change', changeColor);
document.getElementById('penG').addEventListener('change', changeColor);
document.getElementById('penB').addEventListener('change', changeColor);
document.getElementById('penA').addEventListener('change', changeColor);

// 太さ設定スライダーイベントリスナー
document.getElementById('penW').addEventListener('change', changeWidth);

// 消去ボタンイベントリスナー
document.getElementById('clearButton').addEventListener('click', clearCanvas);


// グローバル変数
let mouseDown = false;
let penX = 0;
let penY = 0;
let penColor = "rgba(0,0,0,1)";
let penWidth = 10;
let canvasWidth = document.getElementById("canvasWidth");
let contextWidth = canvasWidth.getContext("2d");

function startDraw(event) {
mouseDown = true;
penX = event.clientX;
penY = event.clientY;
}

function draw(event) {
if (mouseDown) {
let canvas = document.getElementById("main");
let context = canvas.getContext("2d");
context.strokeStyle = penColor;
context.lineWidth = penWidth;
context.lineCap = "round";
let x = event.clientX;
let y = event.clientY;
context.beginPath();
context.moveTo (penX, penY);
context.lineTo(x,y);
context.stroke();
penX = x;
penY = y;
}
}

function endDraw(event) {
mouseDown = false;
}

function changeWidth() {
    penWidth = document.getElementById("penW").value;

    // 太さの見本を描画
    contextWidth.clearRect(0, 0, 20, 20);
    contextWidth.beginPath();
    let radius = penWidth / 2;
    let centerX = 10;
    let centerY = 10;
    contextWidth.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
    contextWidth.fillStyle = "black";
    contextWidth.fill();
}

function changeColor() {
    let penR = document.getElementById("penR").value;
    let penG = document.getElementById("penG").value;
    let penB = document.getElementById("penB").value;
    let penA = document.getElementById("penA").value;
    
    penColor = "rgba("+penR+", "+penG+", "+penB+", "+penA+")";
    
    // 色の見本を描画
    let canvasColor = document.getElementById("canvasColor");
    let contextColor = canvasColor.getContext("2d");
    contextColor.clearRect(0,0,20,20);
    contextColor.fillStyle = penColor;
    contextColor.fillRect(0,0,20,20);
    
    // テキスト表示を更新
    let textColor = document.getElementById("textColor");
    textColor.innerHTML = "R:"+penR+", G: "+penG+", B: "+penB+", A: "+penA;
}

function setColor(r, g, b) {
    document.getElementById("penR").value = r;
    document.getElementById("penG").value = g;
    document.getElementById("penB").value = b;
    changeColor();
}

function clearCanvas() {
    let canvas = document.getElementById("main");
    let context = canvas.getContext("2d");
    // clearRectでキャンバス全体をクリア
    context.clearRect(0, 0, canvas.width, canvas.height);
}

// カラーボタンのイベントリスナー設定
let colbutton = document.querySelectorAll('.pallet button');
for (let i = 0; i < colbutton.length; i++) {
    let btn = colbutton[i];
    let cvalue = btn.value;
    let list = cvalue.split(',');
    let r = list[0];
    let g = list[1];
    let b = list[2];

    btn.addEventListener('click', function () {
        setColor(r, g, b);
    });
}
</script>
</body>
</html>